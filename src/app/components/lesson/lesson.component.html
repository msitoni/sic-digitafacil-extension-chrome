<div class="lesson-container">
  <!-- Header -->
  <div class="lesson-header">
    <button class="back-button" (click)="backToLessons()">
      â† Voltar
    </button>
    <div class="lesson-info" *ngIf="lesson">
      <h2>{{ lesson.title }}</h2>
      <p>{{ lesson.description }}</p>
      <div class="lesson-requirements">
        <span class="requirement">Meta PPM: {{ lesson.minPPM }}</span>
        <span class="requirement">Meta PrecisÃ£o: {{ lesson.minAccuracy }}%</span>
      </div>
    </div>
  </div>

  <!-- Metrics Display -->
  <div class="metrics-panel" *ngIf="isStarted && !showResults">
    <div class="metric" *ngIf="totalRepetitions > 1">
      <span class="metric-label">RepetiÃ§Ã£o</span>
      <span class="metric-value">{{ currentRepetition }}/{{ totalRepetitions }}</span>
    </div>
    <div class="metric">
      <span class="metric-label">WPM</span>
      <span class="metric-value" [style.color]="getPPMColor()">{{ metrics.ppm }}</span>
    </div>
    <div class="metric">
      <span class="metric-label">PrecisÃ£o</span>
      <span class="metric-value" [style.color]="getAccuracyColor()">{{ metrics.accuracy }}%</span>
    </div>
    <div class="metric">
      <span class="metric-label">Erros</span>
      <span class="metric-value">{{ metrics.errors }}</span>
    </div>
    <div class="metric">
      <span class="metric-label">Tempo</span>
      <span class="metric-value">{{ formatTime(metrics.elapsedTime) }}</span>
    </div>
    <div class="metric">
      <span class="metric-label">ConsistÃªncia</span>
      <span class="metric-value">{{ metrics.consistency }}%</span>
    </div>
  </div>

  <!-- Typing Area -->
  <div class="typing-area" *ngIf="!showResults">
    <div class="text-display">
      <span 
        *ngFor="let char of targetText.split(''); let i = index"
        class="char"
        [class.typed]="isCharTyped(i)"
        [class.current]="isCurrentChar(i)"
        [class.space]="char === ' '"
      >
        {{ char === ' ' ? 'â£' : char }}
      </span>
    </div>

    <div class="start-prompt" *ngIf="!isStarted">
      <p>ğŸ‘† Comece a digitar para iniciar a liÃ§Ã£o</p>
      <p class="hint">Dica: Mantenha os dedos na posiÃ§Ã£o inicial (ASDF - JKLÃ‡)</p>
    </div>

    <div class="pause-overlay" *ngIf="isPaused">
      <div class="pause-message">
        <h3>â¸ï¸ Pausado</h3>
        <button class="resume-button" (click)="togglePause()">Continuar</button>
      </div>
    </div>
  </div>

  <!-- Results Screen -->
  <div class="results-screen" *ngIf="showResults">
    <div class="results-header">
      <h2 *ngIf="passed">ğŸ‰ ParabÃ©ns! VocÃª passou!</h2>
      <h2 *ngIf="!passed">ğŸ“ Continue praticando!</h2>
    </div>

    <div class="results-grid">
      <div class="result-card">
        <div class="result-icon">âš¡</div>
        <div class="result-label">Velocidade</div>
        <div class="result-value">{{ metrics.ppm }} PPM</div>
        <div class="result-status" [class.success]="lesson && metrics.ppm >= lesson.minPPM">
          {{ lesson && metrics.ppm >= lesson.minPPM ? 'âœ“ Meta atingida!' : 'âœ— Abaixo da meta' }}
        </div>
      </div>

      <div class="result-card">
        <div class="result-icon">ğŸ¯</div>
        <div class="result-label">PrecisÃ£o</div>
        <div class="result-value">{{ metrics.accuracy }}%</div>
        <div class="result-status" [class.success]="lesson && metrics.accuracy >= lesson.minAccuracy">
          {{ lesson && metrics.accuracy >= lesson.minAccuracy ? 'âœ“ Meta atingida!' : 'âœ— Abaixo da meta' }}
        </div>
      </div>

      <div class="result-card">
        <div class="result-icon">â±ï¸</div>
        <div class="result-label">Tempo Total</div>
        <div class="result-value">{{ formatTime(metrics.elapsedTime) }}</div>
        <div class="result-status">{{ metrics.totalKeystrokes }} teclas</div>
      </div>

      <div class="result-card">
        <div class="result-icon">ğŸ“Š</div>
        <div class="result-label">ConsistÃªncia</div>
        <div class="result-value">{{ metrics.consistency }}%</div>
        <div class="result-status">{{ metrics.errors }} erros</div>
      </div>
    </div>

    <div class="results-actions">
      <button class="action-button secondary" (click)="restartLesson()">
        ğŸ”„ Tentar Novamente
      </button>
      <button class="action-button primary" (click)="nextLesson()" *ngIf="passed">
        â¡ï¸ PrÃ³xima LiÃ§Ã£o
      </button>
      <button class="action-button secondary" (click)="backToLessons()">
        ğŸ“š Ver Todas as LiÃ§Ãµes
      </button>
    </div>
  </div>

  <!-- Action Buttons (during practice) -->
  <div class="action-bar" *ngIf="isStarted && !showResults">
    <button class="action-button small" (click)="togglePause()">
      {{ isPaused ? 'â–¶ï¸ Continuar' : 'â¸ï¸ Pausar' }}
    </button>
    <button class="action-button small secondary" (click)="restartLesson()">
      ğŸ”„ Reiniciar
    </button>
  </div>
</div>
